<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Sorteio de Times</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: Arial, sans-serif;
      background: #0b1020;
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 10px;
    }

    .container {
      background: #161b30;
      width: 100%;
      max-width: 900px;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }

    h1 {
      text-align: center;
      margin-bottom: 12px;
      color: #00e676;
      font-size: 1.4rem;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }

    .col {
      flex: 1;
      min-width: 100%;
    }

    label {
      display: block;
      margin-bottom: 4px;
      font-size: 0.85rem;
      color: #cfd8dc;
    }

    select, input, textarea, button {
      width: 100%;
      padding: 8px 10px;
      border-radius: 5px;
      border: 1px solid #263238;
      background: #1c2331;
      color: #eceff1;
      font-size: 0.9rem;
    }

    textarea {
      min-height: 110px;
      resize: vertical;
    }

    button {
      cursor: pointer;
      background: #00e676;
      color: #000;
      font-weight: bold;
      border: none;
      transition: background 0.2s;
    }

    button:hover {
      background: #00c853;
    }

    .btn-secondary {
      background: #2979ff;
      color: #fff;
    }

    .btn-secondary:hover {
      background: #1565c0;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid #00e676;
      color: #00e676;
    }

    .btn-outline:hover {
      background: rgba(0,230,118,0.1);
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .btn-group button {
      flex: 1;
      min-width: 120px;
    }

    .btn-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .mode-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }

    .btn-toggle {
      min-width: 120px;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #263238;
      background: #1c2331;
      color: #cfd8dc;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-toggle.active {
      border-color: #00e676;
      color: #e4fff2;
      box-shadow: 0 0 0 1px rgba(0,230,118,0.15);
    }

    .textarea-ghost {
      background: #12182c;
      border: 1px dashed #263238;
      color: #eceff1;
    }

    .hidden {
      display: none !important;
    }

    .manual-inline {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .manual-inline input {
      flex: 2;
      min-width: 180px;
    }

    .manual-inline select {
      flex: 1;
      min-width: 120px;
    }

    .hint {
      margin-top: 6px;
      font-size: 0.82rem;
      color: #90a4ae;
    }

    .times-container {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .time-card {
      background: #1e2438;
      border-radius: 8px;
      padding: 10px 12px;
      min-width: 160px;
      flex: 1;
    }

    .time-card h3 {
      margin-bottom: 6px;
      color: #ffca28;
      font-size: 0.95rem;
    }

    .time-card ul {
      list-style: none;
      padding-left: 10px;
      font-size: 0.9rem;
    }

    .time-card li::before {
      content: "‚öΩ ";
      color: #64b5f6;
    }

    .time-card li.goleiro::before {
      content: "üß§ ";
      color: #ffca28;
    }

    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 0.75rem;
      background: #263238;
      color: #fff;
      margin-left: 5px;
    }

    .tag-gol {
      display: inline-block;
      margin-left: 6px;
      padding: 2px 6px;
      border-radius: 12px;
      background: rgba(255, 202, 40, 0.15);
      color: #ffca28;
      font-size: 0.75rem;
      font-weight: bold;
      border: 1px solid rgba(255, 202, 40, 0.35);
    }

    .footer-info {
      margin-top: 12px;
      font-size: 0.75rem;
      color: #b0bec5;
      text-align: center;
    }

    #contadorSobras {
      margin-top: 4px;
      font-size: 0.85rem;
      color: #ff5252;
      font-weight: bold;
    }

    @media (min-width: 600px) {
      .col-half {
        min-width: calc(50% - 5px);
      }
      h1 {
        font-size: 1.6rem;
      }
      textarea {
        min-height: 130px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <button onclick="window.location.href='cronometroeplacar.html'" style="width:100%;margin-bottom:16px;padding:12px 0;font-size:1.1rem;background:#2979ff;color:#fff;border:none;border-radius:8px;box-shadow:0 2px 8px #0004;cursor:pointer;font-weight:bold;">Ir para Cron√¥metro e Placar</button>
    <div id="notificacao" style="display:none;position:fixed;top:24px;left:50%;transform:translateX(-50%);background:#222c44;color:#fff;padding:14px 28px;border-radius:8px;box-shadow:0 2px 16px #0008;font-size:1.05rem;z-index:9999;min-width:220px;text-align:center;transition:opacity 0.3s;opacity:0;"></div>
    <h1 style="text-align:center;color:#00e676;margin-bottom:12px;font-size:1.7rem;">Sorteio de Times</h1>
    <div style="width:100%;display:flex;justify-content:center;margin-bottom:18px;">
      <img src="goleio1.png" alt="Logo Goleio" style="max-width:320px;width:100%;height:auto;border-radius:12px;box-shadow:0 2px 16px #0006;">
    </div>
    <div class="row">
      <div class="col col-half">
        <label for="modalidade">Modalidade</label>
        <select id="modalidade">
          <option value="futsal">FUTSAL</option>
          <option value="society">SOCYET</option>
          <option value="campo">CAMPO</option>
        </select>
      </div>
      <div class="col col-half">
        <label for="jogadoresPorTime">Jogadores por time</label>
        <input type="number" id="jogadoresPorTime" min="1" value="5" />
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div class="mode-toggle">
          <span>Como quer adicionar?</span>
          <div class="btn-group" style="gap:6px;">
            <button id="btnModoLista" class="btn-toggle active" type="button">Colar lista</button>
            <button id="btnModoManual" class="btn-toggle" type="button">Adicionar manual</button>
          </div>
        </div>
      </div>
    </div>
    <div class="row" id="blocoLista">
      <div class="col">
        <label for="textoBruto">Texto completo da lista (cole a mensagem do grupo aqui)</label>
        <textarea id="textoBruto" placeholder="Cole aqui a mensagem com:
GOLEIROS
ATLETAS DE ALTO N√çVEL
LISTA DE ESPERA
"></textarea>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div class="btn-group">
          <button id="btnProcessar">Processar lista</button>
          <button id="btnSortear">Sortear Times</button>
          <button id="btnCopiar" class="btn-outline btn-icon">
            <i data-lucide="clipboard"></i><span>Copiar times</span>
          </button>
          <button id="btnModelo" class="btn-outline btn-icon">
            <i data-lucide="clipboard-list"></i><span>Modelo de lista</span>
          </button>
          <button id="btnLimpar" class="btn-secondary">Limpar</button>
        </div>
      </div>
    </div>
    <div class="row" id="blocoManual">
      <div class="col">
        <label for="manualNome">Adicionar manualmente</label>
        <div class="manual-inline">
          <input id="manualNome" type="text" placeholder="Nome do jogador" />
          <select id="manualTipo">
            <option value="goleiro">Goleiro (GOL)</option>
            <option value="jogador" selected>Jogador de linha</option>
          </select>
          <button id="btnAddManual" class="btn-secondary">Adicionar</button>
        </div>
        <p id="contagemAtual" class="hint">Goleiros: 0 | Jogadores: 0</p>
      </div>
    </div>
    <div class="row" id="blocoCorrigir">
      <div class="col">
        <label for="corrigeNome">Corrigir jogador (mover entre goleiro/linha)</label>
        <div class="manual-inline">
          <input id="corrigeNome" type="text" placeholder="Nome j√° adicionado" />
          <select id="corrigeTipo">
            <option value="goleiro">Mover para Goleiro</option>
            <option value="jogador">Mover para Jogador de linha</option>
          </select>
          <button id="btnMoverTipo" class="btn-outline">Mover</button>
        </div>
        <p class="hint">Use quando adicionou no lugar errado: informe o nome e escolha o destino.</p>
      </div>
    </div>
    <div class="row" id="blocoPreview">
      <div class="col">
        <label for="previewLista">Pr√©via dos nomes adicionados</label>
        <textarea id="previewLista" class="textarea-ghost" readonly rows="6" placeholder="Nenhum nome adicionado ainda."></textarea>
      </div>
    </div>
    <div id="resultado" class="times-container"></div>
    <p class="footer-info">
      O app l√™ ‚ÄúGOLEIROS‚Äù e ‚ÄúATLETAS DE ALTO N√çVEL‚Äù e ignora a lista de espera.
    </p>
  </div>

  <!-- Lucide Icons CDN (opcional) -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <script>
        // Notifica√ß√£o visual personalizada
        function mostrarNotificacao(msg, tempo=3000) {
          const notif = document.getElementById('notificacao');
          notif.textContent = msg;
          notif.style.display = 'block';
          notif.style.opacity = '1';
          clearTimeout(mostrarNotificacao._timeout);
          mostrarNotificacao._timeout = setTimeout(() => {
            notif.style.opacity = '0';
            setTimeout(() => { notif.style.display = 'none'; }, 350);
          }, tempo);
        }
    // inicializa √≠cones Lucide [web:80][web:83]
    if (window.lucide) {
      document.addEventListener("DOMContentLoaded", () => {
        lucide.createIcons();
      });
    }

    const modalidadeSelect = document.getElementById("modalidade");
    const jogadoresPorTimeInput = document.getElementById("jogadoresPorTime");
    const textoBrutoTextarea = document.getElementById("textoBruto");
    const btnModoLista = document.getElementById("btnModoLista");
    const btnModoManual = document.getElementById("btnModoManual");
    const btnProcessar = document.getElementById("btnProcessar");
    const btnSortear = document.getElementById("btnSortear");
    const btnLimpar = document.getElementById("btnLimpar");
    const btnCopiar = document.getElementById("btnCopiar");
    const btnModelo = document.getElementById("btnModelo");
    const manualNomeInput = document.getElementById("manualNome");
    const manualTipoSelect = document.getElementById("manualTipo");
    const btnAddManual = document.getElementById("btnAddManual");
    const corrigeNomeInput = document.getElementById("corrigeNome");
    const corrigeTipoSelect = document.getElementById("corrigeTipo");
    const btnMoverTipo = document.getElementById("btnMoverTipo");
    const resultadoDiv = document.getElementById("resultado");
    const contagemAtual = document.getElementById("contagemAtual");
    const previewLista = document.getElementById("previewLista");
    const blocoLista = document.getElementById("blocoLista");
    const blocoManual = document.getElementById("blocoManual");
    const blocoCorrigir = document.getElementById("blocoCorrigir");
    const blocoPreview = document.getElementById("blocoPreview");

    let goleirosProcessados = [];
    let jogadoresProcessados = [];
    let ultimoTextoCopiavel = "";
    let modoEntrada = "lista"; // lista | manual

    const MODELO_LISTA = `‚úÖ LISTA DOS CONFIRMADOS
Dia XX/XX/XXXX

ü•Ö GOLEIROS

üß§-
üß§-

ATLETAS DE ALTO N√çVEL

1Ô∏è‚É£-
2Ô∏è‚É£-
3Ô∏è‚É£-
4Ô∏è‚É£-
5Ô∏è‚É£-
6Ô∏è‚É£-
7Ô∏è‚É£-
üé±-
9Ô∏è‚É£-
üîü-
1Ô∏è‚É£1Ô∏è‚É£-
1Ô∏è‚É£2Ô∏è‚É£-
1Ô∏è‚É£3Ô∏è‚É£-
1Ô∏è‚É£4Ô∏è‚É£-
1Ô∏è‚É£5Ô∏è‚É£-

LISTA DE ESPERA
1.
2.
3.
4.
5.`;

    modalidadeSelect.addEventListener("change", () => {
      const mod = modalidadeSelect.value;
      if (mod === "futsal") jogadoresPorTimeInput.value = 5;
      if (mod === "society") jogadoresPorTimeInput.value = 7;
      if (mod === "campo") jogadoresPorTimeInput.value = 11;
    });

    function embaralhar(array) {
      let currentIndex = array.length;
      while (currentIndex !== 0) {
        const randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] =
          [array[randomIndex], array[currentIndex]];
      }
      return array;
    }

    // limpeza mais agressiva para tirar emojis/n√∫meros e sobrar s√≥ o nome
    function limparLinha(linha) {
      return linha
        .replace(/^[^A-Za-z√Ä-√ø]+/g, "")          // remove s√≠mbolos/emoji no come√ßo
        .replace(/[0-9]+[¬∫¬∞]?\s*[-‚Äì.]?\s*/g, "") // remove 1-, 10-, 1¬∫-, etc.
        .replace(/[üé±ü•Öüß§‚úÖ]/g, "")              // remove emojis customizados
        .replace(/[‚Ä¢\-‚Äì]+/g, " ")                // bullets e tra√ßos
        .trim();
    }

    function processarLista() {
      const texto = textoBrutoTextarea.value;
      if (!texto.trim()) {
        mostrarNotificacao('Cole a lista completa primeiro.');
        return;
      }

      const linhas = texto.split("\n"); // quebra em linhas [web:66][web:69][web:72]

      let secao = "none"; // none | goleiros | jogadores | espera
      const goleiros = [];
      const jogadores = [];

      for (let bruta of linhas) {
        let linha = bruta.trim();
        if (!linha) continue;

        const upper = linha.toUpperCase();

        if (upper.includes("LISTA DE ESPERA")) {
          secao = "espera";
          continue;
        }
        if (upper.includes("ATLETAS DE ALTO N√çVEL")) {
          secao = "jogadores";
          continue;
        }
        if (upper.includes("GOLEIRO") || upper.includes("GOLEIROS")) {
          secao = "goleiros";
          continue;
        }

        if (secao === "espera") {
          continue;
        }

        const nomeLimpo = limparLinha(linha);
        // garante que tenha pelo menos uma letra (evita quadradinhos) [web:61][web:69]
        if (!/[A-Za-z√Ä-√ø]/.test(nomeLimpo)) continue;

        if (secao === "goleiros") {
          goleiros.push(nomeLimpo);
        } else if (secao === "jogadores") {
          jogadores.push(nomeLimpo);
        }
      }

      goleirosProcessados = goleiros;
      jogadoresProcessados = jogadores;

      mostrarNotificacao(
        'Processado! Goleiros: ' +
        goleirosProcessados.length +
        ' Jogadores: ' +
        jogadoresProcessados.length
      );
      atualizarContagem();
      atualizarPreviewLista();
    }

    function sortearTimes() {
      const goleiros = [...goleirosProcessados];
      let jogadores = [...jogadoresProcessados];
      const porTime = parseInt(jogadoresPorTimeInput.value, 10);

      if (goleiros.length === 0 && jogadores.length === 0) {
        mostrarNotificacao("Nenhum jogador processado. Clique em 'Processar lista' primeiro.");
        return;
      }
      if (!porTime || porTime <= 0) {
        mostrarNotificacao('Informe a quantidade de jogadores por time.');
        return;
      }

      const totalJogadores = goleiros.length + jogadores.length;
      const numTimes = Math.ceil(totalJogadores / porTime);

      jogadores = embaralhar(jogadores);

      const times = [];
      for (let i = 0; i < numTimes; i++) {
        times.push([]);
      }

      goleiros.forEach((g, idx) => {
        const timeIndex = idx % numTimes;
        times[timeIndex].push(g + " (GOL)");
      });

      let iJog = 0;
      for (let t = 0; t < numTimes; t++) {
        while (times[t].length < porTime && iJog < jogadores.length) {
          times[t].push(jogadores[iJog]);
          iJog++;
        }
      }

      const tituloSorteio = "*GOLEIO* (Sorteio)";
      let texto = `${tituloSorteio}\n\n`;
      resultadoDiv.innerHTML = "";
      times.forEach((time, index) => {
        if (time.length === 0) return;

        const nomeTime = `Time ${index + 1}`;
        texto += `üèÜ **${nomeTime}** (${time.length} jogadores):\n`;
        const card = document.createElement("div");
        card.className = "time-card";

        const titulo = document.createElement("h3");
        titulo.innerHTML = `üèÜ <strong>${nomeTime}</strong>`;
        const badge = document.createElement("span");
        badge.className = "badge";
        badge.textContent = `üë• ${time.length} jogadores`;
        titulo.appendChild(badge);

        const lista = document.createElement("ul");
        time.forEach(j => {
          const isGoleiro = j.toUpperCase().includes("(GOL)");
          const nomeLimpo = j.replace(/\s*\(GOL\)/i, "").trim();
          const emoji = isGoleiro ? "üß§" : "‚öΩ";
          texto += ` - ${emoji} ${nomeLimpo}${isGoleiro ? " (GOL)" : ""}\n`;

          const li = document.createElement("li");
          if (isGoleiro) {
            li.classList.add("goleiro");
            const nomeSpan = document.createElement("span");
            nomeSpan.textContent = nomeLimpo;
            const tag = document.createElement("span");
            tag.className = "tag-gol";
            tag.textContent = "üß§ GOL";
            li.appendChild(nomeSpan);
            li.appendChild(tag);
          } else {
            li.textContent = nomeLimpo;
          }
          lista.appendChild(li);
        });
        texto += "\n";

        card.appendChild(titulo);
        card.appendChild(lista);
        resultadoDiv.appendChild(card);
      });

      ultimoTextoCopiavel = texto.trim();
    }

    function atualizarContagem() {
      contagemAtual.textContent =
        `Goleiros: ${goleirosProcessados.length} | Jogadores: ${jogadoresProcessados.length}`;
    }

    function atualizarPreviewLista() {
      if (goleirosProcessados.length === 0 && jogadoresProcessados.length === 0) {
        previewLista.value = "Nenhum nome adicionado ainda.";
        return;
      }
      const linhas = [];
      linhas.push("GOLEIROS:");
      if (goleirosProcessados.length === 0) {
        linhas.push("- (nenhum goleiro)");
      } else {
        goleirosProcessados.forEach(n => linhas.push(`- üß§ ${n}`));
      }
      linhas.push("");
      linhas.push("JOGADORES:");
      if (jogadoresProcessados.length === 0) {
        linhas.push("- (nenhum jogador de linha)");
      } else {
        jogadoresProcessados.forEach(n => linhas.push(`- ‚öΩ ${n}`));
      }
      previewLista.value = linhas.join("\n");
    }

    function alternarModo(modo) {
      modoEntrada = modo;
      btnModoLista.classList.toggle("active", modo === "lista");
      btnModoManual.classList.toggle("active", modo === "manual");
      const isManual = modo === "manual";
      textoBrutoTextarea.disabled = isManual;
      textoBrutoTextarea.placeholder = isManual
        ? "Modo manual ativo. Adicione nomes pelo formul√°rio abaixo."
        : "Cole aqui a mensagem com:\nGOLEIROS\nATLETAS DE ALTO N√çVEL\nLISTA DE ESPERA\n";
      blocoLista.classList.toggle("hidden", isManual);
      blocoManual.classList.toggle("hidden", !isManual);
      blocoCorrigir.classList.toggle("hidden", !isManual);
      blocoPreview.classList.toggle("hidden", !isManual);
      btnProcessar.classList.toggle("hidden", isManual);
      btnModelo.classList.toggle("hidden", isManual);
    }

    function adicionarManual() {
      const nome = manualNomeInput.value.trim();
      const tipo = manualTipoSelect.value;
      if (!nome) {
        mostrarNotificacao('Digite um nome para adicionar.');
        return;
      }

      if (tipo === "goleiro") {
        goleirosProcessados.push(nome);
      } else {
        jogadoresProcessados.push(nome);
      }

      manualNomeInput.value = "";
      atualizarContagem();
      atualizarPreviewLista();
      mostrarNotificacao(`${nome} adicionado como ${tipo === "goleiro" ? "goleiro" : "jogador"}.`);
    }

    function moverJogador() {
      const nome = corrigeNomeInput.value.trim();
      const destino = corrigeTipoSelect.value; // goleiro ou jogador
      if (!nome) {
        mostrarNotificacao('Informe o nome para corrigir.');
        return;
      }

      const nomeLower = nome.toLowerCase();
      const idxGol = goleirosProcessados.findIndex(n => n.toLowerCase() === nomeLower);
      const idxJog = jogadoresProcessados.findIndex(n => n.toLowerCase() === nomeLower);

      if (idxGol === -1 && idxJog === -1) {
        mostrarNotificacao('Nome n√£o encontrado na lista atual.');
        return;
      }

      // Se j√° est√° no destino, apenas avisa
      if ((destino === "goleiro" && idxGol !== -1 && idxJog === -1) ||
          (destino === "jogador" && idxJog !== -1 && idxGol === -1)) {
        mostrarNotificacao('Esse nome j√° est√° no tipo escolhido.');
        return;
      }

      if (idxGol !== -1) goleirosProcessados.splice(idxGol, 1);
      if (idxJog !== -1) jogadoresProcessados.splice(idxJog, 1);

      if (destino === "goleiro") {
        goleirosProcessados.push(nome);
      } else {
        jogadoresProcessados.push(nome);
      }

      corrigeNomeInput.value = "";
      atualizarContagem();
      atualizarPreviewLista();
      mostrarNotificacao(`Movido para ${destino === "goleiro" ? "GOLEIRO" : "JOGADOR"}.`);
    }

    async function copiarTimes() {
      if (!ultimoTextoCopiavel) {
        mostrarNotificacao('Nenhum sorteio para copiar. Sorteie os times primeiro.');
        return;
      }
      try {
        await navigator.clipboard.writeText(ultimoTextoCopiavel); // Clipboard API [web:45][web:78]
        mostrarNotificacao('Times copiados para a √°rea de transfer√™ncia!');
      } catch (err) {
        console.error(err);
        mostrarNotificacao('N√£o foi poss√≠vel copiar os times. Verifique as permiss√µes do navegador.');
      }
    }

    async function copiarModeloLista() {
      try {
        await navigator.clipboard.writeText(MODELO_LISTA); // copia modelo [web:45][web:78]
        mostrarNotificacao('Modelo de lista copiado! Cole no grupo e preencha os nomes.');
      } catch (err) {
        console.error(err);
        mostrarNotificacao('N√£o foi poss√≠vel copiar o modelo. Verifique as permiss√µes do navegador.');
      }
    }

    btnProcessar.addEventListener("click", processarLista);
    btnSortear.addEventListener("click", sortearTimes);
    btnCopiar.addEventListener("click", copiarTimes);
    btnModelo.addEventListener("click", copiarModeloLista);
    btnAddManual.addEventListener("click", adicionarManual);
    btnMoverTipo.addEventListener("click", moverJogador);
    btnModoLista.addEventListener("click", () => alternarModo("lista"));
    btnModoManual.addEventListener("click", () => alternarModo("manual"));

    btnLimpar.addEventListener("click", () => {
      textoBrutoTextarea.value = "";
      resultadoDiv.innerHTML = "";
      goleirosProcessados = [];
      jogadoresProcessados = [];
      ultimoTextoCopiavel = "";
      atualizarContagem();
      atualizarPreviewLista();
    });

    atualizarContagem();
    atualizarPreviewLista();
    alternarModo("lista");
  </script>
</body>
</html>
